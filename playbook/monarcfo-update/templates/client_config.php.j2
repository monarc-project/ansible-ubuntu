<?php
/**
 * Local Configuration Override
 *
 * This configuration override file is for overriding environment-specific and
 * security-sensitive configuration information. Copy this file without the
 * .dist extension at the end and populate values as needed.
 *
 * @NOTE: This file is ignored from Git by default with the .gitignore included
 * in ZendSkeletonApplication. This is a good practice, as it prevents sensitive
 * credentials from accidentally being committed into version control.
 */

 $appdir = getenv('APP_DIR') ? getenv('APP_DIR') : '/var/lib/monarc/fo';
 $string = file_get_contents($appdir . '/package.json');
 if ($string === false) {
     $string = file_get_contents('./package.json');
 }
 $package_json = json_decode($string, true);

return [
    'doctrine' => [
        'connection' => [
            'orm_default' => [
                'params' => [
                    'host' => '{{ master }}',
                    'user' => '{{ item.value.name }}',
                    'password' => '{{ item.value.mysql_password }}',
                    'dbname' => 'monarc_common',
                ],
            ],
            'orm_cli' => [
                'params' => [
                    'host' => 'localhost',
                    'user' => '{{ item.value.name }}',
                    'password' => '{{ item.value.mysql_password }}',
                    'dbname' => '{{ item.value.name }}',
                ],
            ],
        ],
    ],

    'languages' => [
        'fr' => [
            'index' => 1,
            'label' => 'FranÃ§ais',
        ],
        'en' => [
            'index' => 2,
            'label' => 'English',
        ],
        'de' => [
            'index' => 3,
            'label' => 'Deutsch',
        ],
        'nl' => [
            'index' => 4,
            'label' => 'Nederlands',
        ],
    ],

    'defaultLanguageIndex' => 1,

    'activeLanguages' => ['fr','en','de','nl','es','ro','it','pl','pt','ja'],

    'appVersion' => $package_json['version'],

    'checkVersion' => true,
    'appCheckingURL' => 'https://version.monarc.lu/check/MONARC',

    {% if item.value.twoFactorAuthEnforced is defined %}
    'twoFactorAuthEnforced' => {{ item.value.twoFactorAuthEnforced }},
    {% else %}
    'twoFactorAuthEnforced' => {{ twoFactorAuthEnforced | bool if twoFactorAuthEnforced is defined else "false" | bool }},
    {% endif %}

    'instanceName' => '{{item.value.name}}', // will be used for the label of the 2FA QRCode.

    'email' => [
        'name' => 'MONARC',
        'from' => '{{ emailFrom if emailFrom else "info@monarc.lu" }}',
    ],

    'terms' => '{{ terms if terms is defined else "" }}',

    'monarc' => array(
        'ttl' => 60, // timeout
        'salt' => '{{ item.value.salt }}', // private salt for the password
        'cliModel' => 'generic', // model to display for the client, else an ID of model, else 'generic' (empty for all)
    ),

    'mospApiUrl' => 'https://objects.monarc.lu/api/',

    'statsApi' => [
        'baseUrl' => 'http://{{ master }}:{{ monarc_statsservice_port }}/{{ monarc_statsservice_url | urlsplit('path') }}', // stats service running on the back office
        'apiKey' => '{{item.value.statsToken}}' // token of the client generated by "add_inventory.py"
    ],

    'publicHost' => '{{ protocol }}://{{ publicHost }}/{{item.value.name}}{{ '-' + env_prefix if env_prefix else '' }}',

    {% if item.value.isBackgroundImportActive is defined %}
    'import' => [
        'uploadFolder' => '/var/www/{{item.value.name}}/import/files',
        'isBackgroundProcessActive' => {{ item.value.isBackgroundImportActive }},
    ],
    {% else %}
    'import' => [
        'uploadFolder' => '/var/www/{{item.value.name}}/import/files',
        'isBackgroundProcessActive' => {{ isBackgroundImportActive | bool if isBackgroundImportActive is defined else "false" | bool }},
    ],
    {% endif %}
];
